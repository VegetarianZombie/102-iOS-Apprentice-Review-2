<!DOCTYPE html>  
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>03-LabDocument</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style id="mkstylesheet">
body{-webkit-font-smoothing:antialiased;font-family:"Helvetica Neue",Helvetica,Arial,Verdana,sans-serif;margin:30px 0 0;padding:0;background:#fff}#wrapper{padding:20px}li{font-size:110%}li li{font-size:100%}li p{font-size:100%;margin:.5em 0}h1{color:#000}h2{color:#111}h3{color:#111;margin:0}h4{color:#111}h5{color:#111}h6{font-size:1em;line-height:1.5em;margin:1.5em 0}body,p,td,div{color:#111;font-family:"Helvetica Neue",Helvetica,Arial,Verdana,sans-serif;word-wrap:break-word}a{color:#0d6ea1;text-decoration:none;-webkit-transition:color 0.2s ease-in-out;-moz-transition:color 0.2s ease-in-out;-o-transition:color 0.2s ease-in-out;-ms-transition:color 0.2s ease-in-out;transition:color 0.2s ease-in-out}a:hover{color:#3593d9}body{font-size:15px;line-height:21px;margin:0 auto}h1{font-size:37px;line-height:42px;margin-top:42px;margin-bottom:21px}h2{font-size:27px;line-height:42px;margin-top:42px;margin-bottom:21px}h3{font-size:20px;line-height:21px;margin-top:21px;margin-bottom:21px}h4{font-size:20px;line-height:21px;margin-top:21px;margin-bottom:21px}p,ul,ol,pre,table,blockquote{margin-top:21px;margin-bottom:21px}hr{border:1px solid;margin:-1px 0}ul ul,ol ol,ul ol,ol ul{margin-top:0;margin-bottom:0}b,strong,em,small,code{line-height:1}.footnote{color:#0d6ea1;font-size:.8em;vertical-align:super}abbr,acronym{border-bottom:1px dotted #aaa}#wrapper img{max-width:100%;height:auto}dd{font-size:1em;margin-bottom:1em}li>p:first-child{margin:0}ul ul,ul ol{margin-bottom:.4em}caption,col,colgroup,table,tbody,td,tfoot,th,thead,tr{border-spacing:0}table{border:1px solid rgba(0,0,0,0.25);border-collapse:collapse;display:table;empty-cells:hide;margin:-1px 0 1.3125em;padding:0;table-layout:fixed}caption{display:table-caption;font-weight:700}col{display:table-column}colgroup{display:table-column-group}tbody{display:table-row-group}tfoot{display:table-footer-group}thead{display:table-header-group}td,th{display:table-cell}tr{display:table-row}table th,table td{font-size:1.1em;line-height:1.3;padding:.5em 1em 0}table thead{background:rgba(0,0,0,0.15);border:1px solid rgba(0,0,0,0.15);border-bottom:1px solid rgba(0,0,0,0.2)}table tbody{background:rgba(0,0,0,0.05)}table tfoot{background:rgba(0,0,0,0.15);border:1px solid rgba(0,0,0,0.15);border-top:1px solid rgba(0,0,0,0.2)}figure{display:inline-block;overflow:hidden;position:relative;margin:1em 0 2em}figcaption{font-style:italic;text-align:center;background:white;color:#666}.poetry pre{display:block;font-family:Georgia,Garamond,serif !important;font-size:110% !important;font-style:italic;line-height:1.6em;margin-left:1em}.poetry pre code{font-family:Georgia,Garamond,serif !important;word-break:break-all;word-break:break-word;-webkit-hyphens:auto;-moz-hyphens:auto;hyphens:auto;white-space:pre-wrap}blockquote p{font-size:110%;font-style:italic;line-height:1.6em}sup,sub,a.footnote{font-size:1.4ex;height:0;line-height:1;position:relative;vertical-align:super}sub{vertical-align:sub;top:-1px}p,h5{font-size:1.1429em;line-height:1.3125em;margin:1.3125em 0}dt,th{font-weight:700}table tr:nth-child(odd),table th:nth-child(odd),table td:nth-child(odd){background:rgba(255,255,255,0.06)}table tr:nth-child(even),table td:nth-child(even){background:rgba(200,200,200,0.25)}@media print{img,table,figure{page-break-inside:avoid}#wrapper{background:#fff;color:#303030;padding:10px;position:relative;text-indent:0}}@media screen{.inverted{background:#252a2a}.inverted #wrapper{background:#252a2a;color:#eee}.inverted hr{border-color:#333f40 !important}.inverted p,.inverted td,.inverted li,.inverted h1,.inverted h2,.inverted h3,.inverted h4,.inverted h5,.inverted h6,.inverted th,.inverted .math,.inverted caption,.inverted dt,.inverted dd{color:#eee}.inverted pre{background:#ccc}.inverted pre code{color:#111}.inverted table{background:none}.inverted table tr:nth-child(odd),.inverted table td:nth-child(odd){background:none}.inverted a{color:#acd1d5}::selection{background:rgba(157,193,200,0.5)}h1::selection{background-color:rgba(45,156,208,0.3)}h2::selection{background-color:rgba(90,182,224,0.3)}h3::selection,h4::selection,h5::selection,h6::selection,li::selection,ol::selection{background-color:rgba(133,201,232,0.3)}code::selection{background-color:rgba(0,0,0,0.7);color:#eee}code span::selection{background-color:rgba(0,0,0,0.7) !important;color:#eee !important}a::selection{background-color:rgba(255,230,102,0.2)}.inverted a::selection{background-color:rgba(255,230,102,0.6)}td::selection,th::selection,caption::selection{background-color:rgba(180,237,95,0.5)}}

@media print{
#generated-toc-clone,#generated-toc{display:none!important}
}
#generated-toc-clone li.missing,#mkreplaced-toc li.missing{list-style-type:none!important}#generated-toc-clone li, #mkreplaced-toc li{list-style-type:upper-roman}#generated-toc-clone li li, #mkreplaced-toc li li{list-style-type:decimal}#generated-toc-clone li li li,#mkreplaced-toc li li li{list-style-type:decimal-leading-zero}#generated-toc-clone li li li li,#mkreplaced-toc li li li li{list-style-type:lower-greek}#generated-toc-clone li li li li li,#mkreplaced-toc li li li li li{list-style-type:disc}#generated-toc-clone li li li li li li,#mkreplaced-toc li li li li li li{list-style-type:square}
</style>

</head>
<body class="normal firstload">
  <div id="wrapper">
      <h1 id="iosapprenticereview2part3:labinstructions">iOS Apprentice Review 2 Part 3: Lab Instructions</h1>

<p>You’ve seen how to take a Single View app and covert it into a multi screen app, passing data between each of the View Controllers. In this lab, you’re going to expand on this.</p>

<p>The app, in its current state, is basically a read-only. What happens if your users want to write their own story? In this Lab, you’ll create a new View Controller that will allow users to do just that.</p>

<h2 id="part1:setupthecontroller">Part 1: Setup the Controller</h2>

<p>A view controller has already been created for you. If you look in your storyboard, you should seen an view controller that looks like such:</p>

<p>This view controller allows you to create a new story by providing a title, a winning story, and a losing story.</p>

<h3 id="step1:createthecontrollerfile">Step 1: Create the Controller File</h3>

<p>Select <strong>File / New / File</strong>. Select <strong>Source</strong>, then choose <strong>Cocoa Touch Class</strong>. For the class name, write <strong>NewStoryViewController</strong>. Make sure it is a subclass of a <strong>UIViewController</strong> and that the Language is <strong>Swift</strong>. Click <strong>Next</strong>, then <strong>Create</strong>.</p>

<h3 id="step2:addtheoutlets">Step 2: Add the Outlets</h3>

<p>Open <strong>Main.storyboard</strong>. Select your new <strong>View Controller</strong>, and in the Identity inspector, set the class to be <strong>NewStoryViewController</strong>.</p>

<p>Next, open the Assistant Editor, and create IBOutlets for the following controls: <code>storyTitle (Text Field)</code>, <code>monsterType (Segmented Control)</code>, <code>winningStory (Text View)</code>, <code>losingStory (Text View)</code>, <code>backgroundImage (Image View)</code>.</p>

<p><strong>Note:</strong> Forgot how set up an IBOutlet? First, open your storyboard, then switch to your Assistant Editor. Select the control and control drag down to your source code. Release the button, and provide a name for the outlet.</p>

<h3 id="step3:addsomeproperties">Step 3: Add Some Properties</h3>

<p>Switch back to NewStoryViewController.swift. Underneath your IBOutlets, add the following properties:</p>

<pre><code>var newStory: Story?  
var didCancel: Bool = false</code></pre>

<h3 id="step4:createsomeibactions">Step 4: Create Some IBActions</h3>

<p>Typically, you create your IBActions in your storyboard and then fill out the bodies in code. In these examples, you’ll do the reverse. With NewStoryViewController.swift open, add the following IBAction that saves the changes made by the user:</p>

<pre><code>@IBAction func save(sender: AnyObject) {  
    if !storyTitle.text.isEmpty &amp;&amp; !winningStory.text.isEmpty &amp;&amp; !losingStory.text.isEmpty {  
        var storyType: StoryType!  
        if monsterType.selectedSegmentIndex == 0 {  
            storyType = StoryType.zombies  
        } else {  
            storyType = StoryType.vampires  
        }        newStory = Story(title: storyTitle.text, winStory: winningStory.text, loseStory: losingStory.text, type: storyType)  
        performSegueWithIdentifier(&quot;DismissNewStory&quot;, sender: nil)  
    } else {  
        let alert = UIAlertController(title: &quot;Validation Error&quot;, message: &quot;Please fill out all of the fields.&quot;, preferredStyle: UIAlertControllerStyle.Alert)  
        let alertAction = UIAlertAction(title: &quot;OK&quot;, style: .Default, handler:nil)  
        alert.addAction(alertAction)  
        presentViewController(alert, animated: false, completion:nil)  
    }}</code></pre>

<p>Notice that you are calling a new Segue? Don’t worry, you’ll add it in just a second. Now add the cancel action.</p>

<pre><code>@IBAction func cancelStory(sender: AnyObject!) {  
    didCancel = true  
    performSegueWithIdentifier(&quot;DismissNewStory&quot;, sender: nil)  
}</code></pre>

<p>Now to change the background image when the user selects a different story type.</p>

<pre><code>@IBAction func changeMonsterType(sender: UISegmentedControl!) {  
    if sender.selectedSegmentIndex == 0 {  
        backgroundImage.image = UIImage(named: &quot;zombies&quot;)  
    } else {  
        backgroundImage.image = UIImage(named: &quot;vampires&quot;)  
    }}
</code></pre>

<p>With all the IBActions created, switch back to <strong>Main.storyboard</strong>. Select the <strong>Segmented Control</strong>, and control click it. You should see a list of actions. At the end of the Value Changed action, drag the circle to the main New Story View Controller.</p>

<p>From the resulting dropdown, select the <code>changeMonsterType:</code> action. For the cancel button, control click and drag from <strong>Touch Up Inside</strong>. Select <code>cancelStory:</code>. Finally, for the save button, control drag from Touch Up Inside and select <code>save:</code>.</p>

<h3 id="step5:dismissingthekeyboard">Step 5: Dismissing the Keyboard</h3>

<p>While this new view controller works, users will not be able to dismiss the keyboard. Switch back to <strong>NewStoryViewController.swift</strong>, and add the following code in <code>viewDidLoad()</code>:</p>

<pre><code>let tapGesutureRecognizer = UITapGestureRecognizer(target: self, action: &quot;dismissKeyboard&quot;)  
view.addGestureRecognizer(tapGesutureRecognizer)</code></pre>

<p>Gesture recognizers make sure a great way handle to touch controls. In this case, a simple tap gesture will call <code>dismissKeyboard()</code>. Add the following method:</p>

<pre><code>func dismissKeyboard() {  
    view.endEditing(true)  
}
</code></pre>

<p>This method forces any open keyboards to resign their responder status. </p>

<p>Finally, you need to add code to dismiss the keyboard when the user taps the return key.<br/>
At the top of the file, change the class definition to look like the following:</p>

<pre><code>class NewStoryViewController: UIViewController, UITextFieldDelegate, UITextViewDelegate { </code></pre>

<p>Now, add the following methods:</p>

<pre><code>func textViewShouldEndEditing(textView: UITextView) -&gt; Bool {  
    textView.resignFirstResponder()  
    return true  
}
func textFieldShouldReturn(textField: UITextField) -&gt; Bool {  
    textField.resignFirstResponder()  
    return true  
}
</code></pre>

<p>Open <strong>Main.storyboard</strong> and control click on the first text field. Under the list of Outlets, look for the item labeled delegate. Drag from the circle all the way to the New Story View Controller.</p>

<p>Do the same for both of the text views.</p>

<h2 id="part3:tyingitalltogether">Part 3: Tying it all Together</h2>

<p>Now that your view controller is all set, it’s time to hook it into the storyboard. </p>

<h3 id="step1:addabarbuttonitem">Step 1: Add a Bar Button Item</h3>

<p>Open <strong>Main.storyboard</strong> and in the object library, look for a Bar Button Item. Drag it to the navigation bar of the Story Selection View Controller. </p>

<p>With the bar button selected, open the Attributes Inspector and change Identifier to Add.<br/>
Select the bar button item, and control click from it to the New Story View Controller. Select the Present Modally option. Next, select the segue and in the Attributes Inspector, give it the Identifier: NewStory.</p>

<h3 id="step2:createtheunwindsegue">Step 2: Create the Unwind Segue</h3>

<p>An unwind segue is used when you want to return to a previous view controller. In your case, you presented the New Story View Controller and once the user has created that story, you need a way to get it.</p>

<p>Open <strong>StorySelectionViewController.swift</strong> and add the following code:</p>

<pre><code>@IBAction func close(segue:UIStoryboardSegue) {  
    let newStoryViewController = segue.sourceViewController as NewStoryViewController  
    if !newStoryViewController.didCancel {  
        if let story = newStoryViewController.newStory {  
            if story.type == .zombies {  
                zombieStories.append(story)  
            } else {  
                vampireStories.append(story)  
            }            tableView.reloadData()  
        }    }  
}</code></pre>

<p>Once have the segue added, make sure to build your project before moving to the next step.</p>

<h3 id="step3:hookuptheunwindsegue">Step 3: Hook Up the Unwind Segue</h3>

<p>Open <strong>Main.storyboard</strong>. In the New Story View Controller, select the yellow View Controller icon and control drag over to the last red icon. </p>

<p>From the dropdown, choose the close: <strong>segue</strong>. Congratulations! You made it through the lab and have a working app!</p>
<!-- ##END MARKED WRAPPER## -->
    </div>
</body>
</html>